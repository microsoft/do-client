# Pipeline to build DO C++ SDK using docker to target non-native OS and/or architecture.
# Publishes the binaries + packages as artifacts.

variables:
- name: imageVersion
  value: 0.8.0
- name: containerImageVersion
  value: 0.9.0

# Disable branch and pr triggers - currently run this manually to avoid hogging build machine resources
# Rely on Ubuntu x64 pipeline for CI/CD
trigger:
- none
pr:
- none
schedules:
- cron: "0 0 * * *"
  displayName: Daily midnight build
  branches:
    include:
    - develop

parameters:
- name: buildTargets
  displayName: "OS and Architectures to build"
  type: object
  default:
    - debian10_arm32
    - debian10_arm64
    - debian10_x64
    - debian11_arm32
    - debian11_arm64
    - debian11_x64
    - ubuntu1804_arm64
    - ubuntu2004_arm64
    - ubuntu2004_x64
    - ubuntu2204_arm64
    - ubuntu2204_x64

pool:
  name: 1es_hosted_pool_ubuntu_1804
  demands: ImageOverride -equals do-adu-build-$(imageVersion)

jobs:
- ${{ each target in parameters.buildTargets }}:
  - template: ../templates/do-docker-jobs.yml
    parameters:
      targetOsArch: ${{target}}
      imageVersion: ${{variables.containerImageVersion}}
      stepsTemplate: 'dosdkcpp-docker-steps.yml'
