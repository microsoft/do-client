# Template: Jobs to build DO projects using docker to target non-native OS and/or architecture.
# Consume this jobs template in a pipeline yaml by passing in parameter values.

parameters:
- name: targetOsArch    # example: ubuntu2004_arm64
  type: string
- name: imageVersion
  type: string
- name: stepsTemplate   # example: dopapt-docker-steps.yml
  type: string
- name: type
  type: string

jobs:
- job: ${{parameters.targetOsArch}}
  steps:
  - checkout: self
    path: 's' # Copy to sources directory (templates do not do this automatically)

- job: ${{parameters.targetOsArch}}_debug
  steps:
  - template: ${{parameters.stepsTemplate}}@self
    parameters:
      targetOsArch: ${{parameters.targetOsArch}}
      imageVersion: ${{parameters.imageVersion}}
      config: debug

- job: ${{parameters.targetOsArch}}_release
  steps:
  - template: ${{parameters.stepsTemplate}}@self
    parameters:
      targetOsArch: ${{parameters.targetOsArch}}
      imageVersion: ${{parameters.imageVersion}}
      config: minsizerel

  templateContext:
    outputs:
    - output: pipelineArtifact
      displayName: 'Publish artifacts'
      targetPath: '$(Build.ArtifactStagingDirectory)'
      artifact: 'doclient-drop-$${{parameters.type}}-${{parameters.targetOsArch}}'
