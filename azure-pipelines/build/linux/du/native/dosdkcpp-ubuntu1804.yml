# Pipeline to build DO C++ SDK targeting x86-64 architecture.
# Client-lite is built for running tests alone, it is not published.
# Publishes the binaries + packages as artifacts.

variables:
- name: imageVersion
  value: 0.8.0
- name: containerImageVersion
  value: 0.9.0

# TODO: Delete before merging PR, when the other pipeline is working fine.
trigger: none
pr: none

parameters:
- name: buildConfigurations
  displayName: "Configurations to build"
  type: object
  default:
    - debug
    - minsizerel

pool:
  name: 1es_hosted_pool_ubuntu_1804
  demands: ImageOverride -equals do-adu-build-$(imageVersion)

jobs:
- ${{ each config in parameters.buildConfigurations }}:
  - job: ubuntu1804_x64_${{ config }}
    steps:
    - template: '../templates/dosdkcpp-docker-steps.yml'
      parameters:
        targetOsArch: 'ubuntu1804_x64'
        imageVersion: ${{ variables.containerImageVersion }}
        config: ${{ config }}
        ${{ if eq(config, 'debug') }}:
          skipTests: false
        ${{ else }}:
          skipTests: true
    - publish: $(Build.ArtifactStagingDirectory)
      artifact: 'doclient-drop-ubuntu1804_x64-${{config}}'
