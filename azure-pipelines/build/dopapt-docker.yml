# Pipeline to build DO Plugins using docker to target non-native OS and/or architecture.
# Publishes the binaries + packages as artifacts.

# Disable branch and pr triggers - currently run this manually to avoid hogging build machine resources
# Rely on Ubuntu x64 pipeline for CI/CD
trigger:
- none
pr:
- none
schedules:
- cron: "0 0 * * *"
  displayName: Daily midnight build
  branches:
    include:
    - main

# TODO(jimson): Provision a 1ES managed image with artifacts that have all our dependencies preinstalled
#pool: 1es_hosted_pool_ubuntu_1804

# The microsoft-hosted agents come with docker preinstalled, the caveat being that the bootstrap script needs to be called to provision everything else
pool:
  vmImage: 'ubuntu-18.04'

jobs:
- template: templates/do-docker-jobs.yml
  parameters:
    targetOS: 'debian10'
    targetArch: 'arm32'
    stepsTemplate: 'dopapt-docker-steps.yml'

- template: templates/do-docker-jobs.yml
  parameters:
    targetOS: 'debian9'
    targetArch: 'arm32'
    stepsTemplate: 'dopapt-docker-steps.yml'

- template: templates/do-docker-jobs.yml
  parameters:
    targetOS: 'ubuntu1804'
    targetArch: 'arm64'
    stepsTemplate: 'dopapt-docker-steps.yml'
