# Pipeline to build DO Agent targeting x86-64 architecture.
# Publishes the binaries + packages as artifacts.

variables:
- name: imageVersion
  value: 0.8.0

trigger:
  branches:
    include:
      - main
  paths:
    include:
      - azure-pipelines/build/doclient-lite-native.yml
      - azure-pipelines/build/templates/doclient-lite-native-steps.yml
      - client-lite/*
      - common/*
      - build/build.py
      - CMakeLists.txt
    exclude:
      - azure-pipelines/*

pr:
  branches:
    include:
      - main
  paths:
    include:
      - azure-pipelines/build/doclient-lite-native.yml
      - azure-pipelines/build/templates/doclient-lite-native-steps.yml
      - client-lite/*
      - common/*
      - build/build.py
      - CMakeLists.txt
    exclude:
      - azure-pipelines/*

pool: 
  name: 1es_hosted_pool_ubuntu_1804
  #TODO(jimson): After Imagefactory check-in is completed and we can create new image, use the commented below
  #vmImage: do-adu-build-$(version)
  vmImage: do-adu-build-2

jobs:
- job: Debug
  steps:
  - template: templates/doclient-lite-native-steps.yml
    parameters:
      targetOsArch: 'ubuntu1804_x64'
      config: debug

- job: Release
  steps:
  - template: templates/doclient-lite-native-steps.yml
    parameters:
      targetOsArch: 'ubuntu1804_x64'
      config: minsizerel
      skipTests: true
